PROGRAM NlII~L
SE TS THE INITIAL CONOITIONS FOR EACH RAY ANO CALLS TRACE
JINENSION MFLO(2'

NIT 1001
NITIOC2
NITI003

COMMON tCDNSTI PI.PIT2,PI02.0~GS,RAO,K,C,LOGTEN
:OMHON IFLGI NTYP,NEWHR,NEWWP,PENET,LINES,IHOP,HPUNCH

NITI004
NIlIOOS

:OMHON IRINI

1

:OHHON IRKI

P100~IN('3) .COLL,F[ELO.S=-ACE,N2,N2I.PNP(tO},?JlAR.
LPOUR.SGN
N,STEP,HOOE,EIMAX,El~I~.E2HAX,EZMIN,FACT,~START

:;OHMON IX'1..I "'001(2) ,X,PXPR,P)( :tTH,P I( :lPH,P XP T,HMAX
CONNON IVYI "00Y.Y(16' IlU NJOl.Z{f.'

NITI006

NITI007

NITtOOS

NITI009
NITI010
COMMON R(ZQ},T,STP,O~OT(20) /JiW/ 1)(10),HQ,W(ItOOI
NITrOl1
EQUIVALENCE (R.AY .. W(U),(EARTH~,W(2),(XMTRH,W{3)},(TLAT,"(It»,
NITI012
1 <TLON,W(SlJ,(F,W(6»,(FBEG,\oI(71),(FENO,WUH),(FSTEP,IH9»,
NITIOl3
2 (AZ1,WUOJ) ,(AZ3EG,W(111) ,(AZEND.WClZ», (AlSTE"P,W(13J),
NITI014
3 (BETA,W(11t)',(ELBEG,HUS)J,CELENO,WC1&)),(ELSTEP,W(17l',
NITI01S
:. (ONLY,W(2lt), (HOP,W(2Z», 01AKST',W(Z3», (PLAT,W(Z4») ,(PLON,W(Z5' 'NITIOt&
S. (lNTYP,WC't1), (HAXERR,W(!.tZ»), (ERATlO,WC43", (SlEP1,W(Lt4»),
NITI017
& (STPHAX,W(45J ',(STPMIN,W(4&1', (FA :::TR,W(47)I, (SI(IP,W(71)),
NITr018
7 (RAYSET,W(72).(PLT,W(81)',C'ERl,,..(150')
NITI019
LOGICAL SPACE,NEWWq,NEWWP,PENET
NITIOZO
~EAL NZ.N2I,LJGlEN,K,MAXSTP,I~TYP,1AXERR,MU
NIlIOZ1
COM PLEX PNP,POlAR,LPOlAR
NITIOZZ
NQATE=IDATECQJ
NITIOZ5
SECONO=KLOCK(O)".OOl
NIT 1026
<OLL'4H
~J
NITI027
IF (C OLL.NE.O.' (OLL=4HWITH
NITI028
C'" .......... CONSTANTS
NIT IOZ9
PI=3.1415n6536
NIT 1030
PIT2=2."PI
NITI031
'I02=PI/2.
NIT 1032
OEGS=180.IPI
NITIOH
RA O=PI/18D.
NITI034
;=2.997925E5
NITI035
K=2.81785E-15"C"21PI
NITI036
LOGTEN=AL):;11D.1
NIT 1037
C.. •••••••• INITIALIZE SOME VARIABLES IN THE H ARRAY
NITI038
00 5 NW=1 •• 00
NITI039
5 W(NH'=Q.
NITIG40
PLON=O.
NITI041
PLAT=P102
NITI042
EARTHR=6370.
NITI043
INTYP=3.
NIT 1044
~AXERR=1.E·4
NITI045
ERATIO=50.
NIT 1046
STEP1=1.
NIT 1047
HPMAX=100.
NIT 1048
STPMIN=1.E·8
NITI049
FACTR=0.5
NITI050
HAXSTP=l~OO.
NIT1051
"HOP=l.
NIT 1052
C· .. ••••••• REAO W ARRAY AND PRINT NON-ZE~O VALUES
NIlI053
10 CALL REAO W
NITI054
F=BETA=AZ1=O.
NIT 1055
IF (SKIP.EQ.O.' SKIP=HAXSTP
NITI056
12
RAY :SIGNll .. RAYI
NITI057
~TYP:Z.+FIELO·RAY
NITI05S
GO TO (13.14,15). NTYP
NITI059
13 HFLOI1l:8HEXTRAORO
NITI060
NFLO(2':5HINARY
NIT 1061
;0 TO 16
NIT 1062
14 NFLOI1l:8HNO FIELO
NIT 1063
MFLOIZ.:1N
NITI064
:;0 TO 16
NIT 1065

69

15 MFLDIII=8HORDINARY
MFLDI21=8H
16 MODSAV=MODXI21
IF (PERT.Ea.o.1 MODX(21=6H
IF

(RAYSET.NE.O.I PUNCH 2000,

ID,MODXI!I,(WINW),NW=101,101),

1 MOOX(2I,(W(NWI ,NW=151.157) ,MODY,I'WINWI ,NW=201,Z071,

2 MODl,(WINW I ,NW=251,2571
2000 FORMAT (lOA8,4(/A8.2X.1EIO.31)
PR I NT 1000. 10 ,NUA TE ,MOD"- • MOul' • MOOZ ,MOCR 1 N .MfLu .KOLL
1000 FORMAT (lHl,lOA8,25X,1\8/4(lX'A/jJ'L4X'~A!j'lX'AO'A:>'L};'A4'

NITI066
NITI061
NITI068
NITI069
NITI07Q

NITI011
NI Tl012
NITI013
'''0 I aU 14

NJTIU'~

I IlH COLLISIONS/i
NITI016
PRINT In 50
NITIOl1
1050 FORMAT 185H INITIAL VALUES FOR THE W AR~AY -- ALL ANGLtS IN RADIAN"u I JU 10
IS. ONLY NONZERO VALUES PRINTED/I
NJ I lU79
DO 17 NW=1,400
NIII080
IF (WCNWI.NE.o.1 PRINT 1700. NW,WINWI
NITl081
1700 FORMAT (14,EI9.111
NITI082
]7 CONTINUE
NITI083
c********* LET SUBROUTINES PRtNTR AND RAYPLT KNOW THERE IS A NEW W ARRAYNITIOB4
NEWWP=.TRUE.
NIT 1085
NEWWR=.TRUE.
NITI086
c********* INITIALIZE PARAMETERS FOR INTEGRATION SUBROUTINE RKAM
NITI081
N=6
NITI088
DO 20 NR=7,20
NITI089
IF (W(50+NRI.NE.O.1 N=N+l
NIT 1090
20 CONTINUE
NJ I lu91
MOOE=INTYP
NITIOn
STEP=STEPI
NI I 1093
ElMAX=MAXERR
NIIIU94
EIMIN=MAXERR/ERATIO
NlTI095
E2MAX=STPMAX
NlTI096
E2MIN=STPMIN
NITI091
FACT·FACTR
NITl098
C********* DETERMINE TRANSMITTER LOCATI ON IN COMPUTATIONAL COO~OINATE
NIT 1099
c********* SYSTEM (GEOMAGNETIC COOROINATES IF DIPOLE FIELD IS U~EDI
N(lllOO
RO<EARTHR+XMTRH
NlTIIOl
SP=SIN IPLATI
NlTII02
CP-SIN IPID2-PLATI
NITl103
SDPH=SIN I TLON-PLON I
N1.T1104
CDPH=SIN IPID2-ITLON-PLONII
N 111105
SL=SIN fTLATI ·
NlTll06
CL=SIN IPI02-TLATI
NITII01
ALPHA=ATAN2(-SDPH*CP,-CDPH*CP*SL+SP*CLI
NITll08
THO=ACOs (CDPH*CP*CL+SP* SLJ
NIT 1109
PHO=ATAN2(SDPH*CL,CDPH*SP*CL-CP*SLI
NITIIIO
NITllll
C********* LOOP ON FREQUENCY, AZIMUTH ANGLE' AND ELEVATION ANGLE
Nl111l2
NFREQ=1
Ni l 111 ~
IF (FSTEP.NE.O.I NFREQ.{fENO-F~~GI/~Slt~+l.~
NI II114
NAZ=1
NITIl15
IF (AZSTEP.NE.O.1 NAZ=(AZEND-AZBEGIIAL~ltP+l.~
NlTIl16
NBETA=1
NITll11
IF IELSTEP.NE.O.I NBETA=IELEND-ELBEGI/ELSTEP+I.5
NITI1l8
DO 50 NF=l.NFREQ
NlTI1l9
F=FBEG+INF-ll*FSTEP
NITl120
DO 45 J=l,NAZ
NIT1121
AZl=AZBEG+IJ-ll*AZSTEP
N111122
AZA=AZl*OEGS
N1I1123
GAMMA=PI-AZ1+ALPHA
NITI124
SGAMMA<SIN IGAMMAI
NITI125
CGAMMA=SIN (PID2-GAMMAI
NITll26
00 40 I=l,NBETA
NlTI121
BETA=ELBEG+II-ll*ELSTEP

70

~L=AETA*nFr,s

NITII2e

CBETA=SIN (PID?-BETAl
R(l}=RO
R(2)=THO
RI11=PHn
R(4)=SIN (BETAl

NITI12q

R(Sl=CBETA*CGAM~A

NITI13 0
NITI131
NITI132
NITII31
NITI134

R(6)=CAET~4SGAM~A

Nlr113~

T=r1.
RSTART=I.
C
SGN=l.
(NEt:D FOR RAY TRACINCl IN COr.1PLEx SPACE.)
c********* ALLOW 10NO~PHERIC MOD~L SU~ROUTINES TO READ AND PRIN1 DATA
CALL RINOfX
IF (I.NE.l.AND.NPAGE.LT.3.AND.LINES.L~.l7) GO 1025

NITIl3£,
NITIl37
NITI138
NITt139
NITIl4U
NIl I141
~PAGE~LINFS=n
NITJ142
PRINT lnoo, JD,NDATE,rv.O()X,t··, U()Y,~Of)L,."1V[)1-<11\j,MI-L[)'''ULL
NT r 1143
PRINT 2400, F,AZA
NITf144
2400 FORMAT (18X,11HFREQUENCY =,FI2.6,37H MHZ, AZIMlJTH ANGLE OF TRANSMINITI145
lSSION = ,F12.6,4H DEG)
NITI146
25 NPAGE=NPAGE+l
NITI147
PRINT 2500, EL
NITr148
250n FORMAT U31X,33HELfVATION ANGLI: 01- TRANSMl~.slUN =,l-l£.6,4H [)EG/I NIlr149
IF (N2.GT.n.l GO Tn 30
NIT1150
CALL ELECTX
NITI15l
FN=SIGN (SORT (ABS (Xll*F,XI
NIT"Il5?
PR I NT 7 Q on, FN
NITr151
2900 FORMAT (58HOTRANSMITTER IN EVANfSCENT REGION, TRANSMISSION IMPOSSINITI154
lBLE/20HoPLASMA FRECUENCY = ,El7.]01
NITI155
GO TO 44
NITI156
30 MU =SQRT (N2/(R(41**2+R{5 1**2+R(61**21)
NITI157
DO 34 NN =4,6
NITIl~8
34 R ( NN1=R ( NN1*~U
NITI159
DO 35 NN=7,N
NITI160
35 R(NN1 =O.
NITI161
CALL TRACE
NITI162
OSEC =SECOND
NITll63
SECOND=KLnCKlol*.OOl
NITI166
DIFF=SECONO-OSEC
NITIl65
PRINT 3500, DIFF
NITI166
3500 FORMAT (36X,26HTHIS RAY CALCULATION TOOK ,FB.3,4H SEC)
NTTI167
IF ( PENET.AND.ON LY.NE.n •• ANO.IHOP.fO.ll GO TO 44
NITI168
40 CONTINUE
NITIl69
44 IF (P LT.NE.O.) CALL ENDPLT
NITI170
45 CONT I NUE
NITIl71
IF( PENET.AND.ONLY.NE.O •• AND.IHOP.EO.l.AND.NAZ.EQ.l,AND.NBETA.EQ.llNITI172
1 GO TO 5S
NITI173
50 CONT I NUE
NITI174
5C;
IF ( RAYSET.NE~O.1 PUNCH 5000
NITI175
soon FOR~AT (78X,lH- l
NITI176
MODXI21=MODSAV
NIT1177
GO TO 10
NITIl78
END
NITIl79 -
