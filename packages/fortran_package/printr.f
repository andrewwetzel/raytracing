SUBROUTINE PRINTRINWHY.CAROI
PRINTS OUTPUT AND PUNCHES RAYSETS WHEN REQUESTED
DIHENSION GI3,31.G113.31.TYPEI31.HEADR1IZ01.HEADRZIZOI.UNITSIZOI.
1
HEA 0 1( Z DI • HEAOZ 1 Z0 I • UNIT 1ZDI • RP RINT< ZDI • NPR ( Z0 I
COHHON ICONSTI PI.PITZ.PIOZ. OEGS.RAO.OUHI31
COHMON

IFLGI -. TY p, NEWWR, ~ EWMP, PENE T, LINES, IHOP, HPUNCH

COHHON IRINI NOORIN(3).COLL.FIELO,SPACE.NZ.NZI.PNPll01.POLARIZI,
1
LPOLARIZI
COHHON RIZDI,T IW~I IOltal.WO.W(400)
ElU IVAL ENCE <THET A .R 1Z)) • IPH I. R (311
EQU I VAL EN CE 1EART ~R. W1ZII • 1XHT RH. W( 31 I • 1TLAT • W1411 • 1TL ON. WI 51 I •
1
~

( F , W(&) ) , (4 Z 1 , W( 1 0 ) ) , (BE T A, W( 14) ) , (RC VRH , \of ( 20 ) ) , (H OP, W( 22) ) ,
(PLAT,W(Z4»,(PLON,W(Z5»,(RAYSEf,W(7Z)
LOGICAL SPACE,NEWWR,NEWWP,PENET
~EAL NZ,NZI,LPOlAR

COMPLEX PHP
OA fA IT YPE=lHX .1HN ,1HO)
~,(HEAOR1(71 = €d

Pt-IAS)'(H::AORZ(7)=&HE

PATH) ,(UNlfS(7J=&H

1(f'1) t

3 IHEAOR1I81=6H ABSOI. (HEAORZI81 =6HRPTION). (UNITSI81=6H
OB I.
"IHEAOR1I91 =6H
OOPI.(HEAORZI91=6HPLER I,(UNITSI91=6H CIS I.
, IHEAOR1Il01=5H PATH 1.IHEAORZI101=6HLENGTHI.IUNITS(101 =6H
XH
CALL RINOEX
IF (.NOT.NEWW'I GO TO 10

78

PDLCOZ7
POLC028
POLc029
POLC030
POLC031
POLC032
POLC033
POLC034
POLC035
POLC036
POLC037
POLC038
POLC039
POLc040
POLC041
POLc04Z
POLC043
POLC044
POLC045
POLc046
POLC047
POLC048
POLC049
POLC050
POLC051
POLC 52PRINODl
PRINDDZ
PRI NOO 3
PRIN004
PRINODS
PRIN006
PRIN007
PRINOO!
PRIN009
PRIN010
PRINOl1
PRIN01Z
PRI N013
PRI N014
PRIN015
PRIND16
PRIN017
PRIND18
PRI ND19
PRINDZD
PRINOZ3
PRINOZ4
PRINDZS

c.. • .. •••••• NEW W ARRAY -- REINITIAlIZE

PRIN026

NEWWP=. fALSE.
SPL=SIN (PLON-TLONI
GPL=SIN (PIOZ- (FLON-TLONI I
SP=SIN IPLATI
~P=SIN (PIOZ-?LATI
SL=SIN (fLAT!
CL=SIN IPIOZ-TLATI

PRIN027
PRINOZ6
PRINOZ9
PRIN030
PRIN031
PRIN03Z
PRIN033

C...... •• ... •• MATRIX TO ROTATE COORDINATES
G (1,1) =CPl·Sp· CL -C P·SL

PIUN03'4
PRIN035

GI1.ZI=SPL·SP
G(1.31=-SL·SP·e fL-eL'ep
GIZ.11=-SPL·GL
GIZ.ZI=CPL
GIZ.31=SL·SPL

PRIN036
PIUN037
PRIN036
PRIN039
PRIN040

G(3,1)=Cl·CP·~PL+SP·SL

PRIN041

GI3.21=CP·SPL
GI3.31=-SL·CP·eFL+SP·CL

PRIN042
PRIN043

OENH=G(1,1)"'G(Z,Z)"'G(3.3)+G(1,Z)"'G(3,1)"'G(Z,3)+G(Z,1)'"G(3,Z)·G(1,3PRIN044
lJ-G(Z,Z)·G(3,1)"'G(1,3)-G(1.Z)·G(Z,1)·G(3,J)-G(l.1)·G(3,2)·G(2,3)
PRIN045

C·········
THE "ATRIX G1 IS THE INVERSE OF THE HATRIX G
G111.11=(GI2.ZI·GI3.31-GI3.ZI'GIZ.311/0ENH
G111.21=IGI3.ZI·GI1.31-GI1.ZI·GI3.311/0ENH

PRIN046
PRIN047
PRIN048

Gl(1,3)~(G(1,2)·G(2,3)-G(2,2)"'G(lt3»)/OENH

PRIN049

G1IZ.11'IGI3.11·GI2.31"GIZ.11'GI3.311/0ENH
G1 12.Z1 = (G 11.U·G 13.31 -GI 3 .il·G (1,31 I/OENH
G1IZ.31=IGIZ.11·GI1.31-GI1.11·GIZ.311/0ENH
G113.11=IG(Z.11·GI3.21-GI3.11·GI2.211/0ENH
G113.ZI=IGI3.11·G(1.21-GI1.11'GI3.211/0ENH
G113.31=IGI1.11'GI2.ZI-GI2.11·GI1.211/0ENH
RO=EARTHR+XHTRH
e.. • .... •• CARTESIAN COORDINATES OF TRANSHITTER
XR=RO·GI1.11
YR=RO·GI2.11
ZR=RO·GI3.11
eTHR=GI3.11
STHR=SIN lAeos leTHRI I
PHIR=ATANZ IYR. XRI
ALPH=ATlN2(GI3.ZI.GI3.311

PRINOSO
PRINOS1
PRIN052
PRIN053
PRINOS4
PRINOS5
PRIN05&
PRINOS7
PRIN058
PRIN059
PRIN060
PRIN061
PRIN062
PRIN063
PRIN064

e···· ........
·
NR=6

PRINO&5

PRIN066
NP=O
PRIN067
00 7 NN=7.20
PRIN068
IF IWINN+SOI .EIl.. O. I GO TO 7
PRIN069
DEPENDENT VARIABLE N~HBER NN IS BEING INTEGRATED
PRIN070
NR IS THE NUMBER OF DEPENDENT VARIABLES BEING INTEGRATED
PRIN071
NR=NR+1
PRIN072
IF IW INN+SOI .NE.2. I GO TO 7
PRINOT3
DEPENDENT VARIABLE NJHBER NN IS BEING INTEGRATED AND PRINTED.PRINOT4
NP IS THE NUMBER OF DEPENDENT VARIABLES BEING INTEGRATED AND PRIN075
c.. ••••• .. •• PRINTE)
PRIN07&
NP=NP+1
PRIN07T
SAVE THE INDEX OF THE DEPENDENT VARIABLE TO PRINT
PRINOT8
PRI N079
NP RINPI =NR
PRIN080
~EA01 INPI =HEADR1 INNI
PRIN081
HEADZ IN?I =HEADR ZINNI
PRI N08Z
UNITINPI=UNITSINNI
PRIN083
7 CONTINUE
PRIN084
W1=HINO INP. 31
PRI N085
PDEV=ABSOR8=DOPP=O.

C·········
C·········

C·········
C·········
c·········

79

c·.·· ... ·· PRINT COLUMN HEADINGS AT THE BEGINNING OF EACH RAY

PRIN08&

IF <IHOP.NE.O) GO TO 12
PRIN087
PRINT 1100. (HEA01(NN) .HEA02(NN).NN=1.NP1)
PRIN088
1100 FORMAT (I.4X.7,jAZIMUTH/43(.9HOEVIATION.6X.9HELEVATIONI
PRIN089
1 19X.16HHEIGHT
RANGE.1X.2(SX.12HXMTR
LOCAL).SX.26HPOLARIZATIPRIN090
20N
GROUP PATH. SA6.AS)
PRIN091
PRINT l1S0. (JNIT(NN) .NN=I.NPll
PRINOn
til

115.:1 FORMAT C13X,2C8X,2HKM',ZJ(,Z{&X,3HOEG,5X,3HDEG1,&X,12HREAL
1 7X,ZHKH,4X,3(4X,A&,2X»

IHAG.PRtN093
PRIN094

IF (RAYSET .EQ. 0.) GO TO 12
C·· ...... •• .. • PUNC"f A TRANSMITTER

PRIN09S

RA~SET

PRIN09&

TLONO=TLON'OEGS
IF <TLONO.LT.O.) TLONO=TLONO.360.
TLATO=TLAT'OEGS
IF <TLATO.LT.O.) TLATQ=TLATO'360.
AZ=AZ1'OE,S
EL=BETA'OEGS
NHOP=HOP

PRIN097
PRIN096
PRIN099
PRIN100
PRIN101
PRIN102
PRIN103

PUNCH 1200, 10(i) ,TYPE(NTYP) ,XMTRH,TLATD, TLONO,RC'lfRH,F,AZ,EL,POLARPRIN104
1,NHOP,lHT
PRIN10S
1200 FORHAT (A3,A1,4PF9.0,3PlFEJ.O,4PZF9.0,5PZF10.0,5X,2P2F5.0. Il,AU
PRIN10&
PRIN107

C·· 12
. · . ··V=O.. ·
IF

PRIN106

(Nl.NE.O.l

'If=(R(4)··2+~(5)"·2+R(o)··Z)/N2-1.

PRIN109

H=R(1)-EARTHR
PRIN110
STH=SIN (THETA)
PRIN111
CTH=SIN (Pro2-THETA)
PRIN112
CARTESIAN COOROINATES OF RAY POINT. ORIGIN AT TRANSMITTER
PRIN113
XP=R(1) 'STH'SIN (PI02-PHI) -XR
PRIN114
YP=R(1)'STH'SIN (PHI)-YR
PRIN115
ZP=R(1)'CTH-ZR
PRIN116
CARTESIAN COORDINATES OF RAY POINT. ORIGIN AT TRANSMITTER ANOPRIN117

C·········

C········.
C·········
ROTATED
EP5=Xp· G1 (1,1) +yp. G1< 1,2) + Zp·G 1 (1, 3)
~CE2=ETA··2+ZETA··2

PRIN116
~I N1l 9
PRIN1Z0
PRt N121
PRIN12Z

<CE=SQRT (R"EZ)

PRIN1Z3

ETA=Xp·Gl(Z,1) +VP·Gl(l,Z)+ZP·G1(Z,3)
ZE T A%:XP.Gl (3,1) +yp. Gl (3,2) +ZP.G 1( 3,3)

C········· GROUND

~ANGE

PRIN124

RANGE=EART HR' ATAN2 (RCE. EA RTHR'EPS)

PRI N1Z5

C········· ANGLE OF WAVE NORMAL WITH LOCAL HORIZONTAL

ELL=ATANZ(R(') .SQRT (R(5)"ZtR(6)"Z))'OEGS
OISTAN~E FROM TRANSMITTER TO RAY POINT

PRIN1Z6

IF (NP.LT.ll GO TO 16
DO 1S I=1.N?
NN;NPR(I)
15 RPRINT(I)=R[NN)
16 IF (SR •• E.1.E-6) GO TO ZO
TOO CLOSE TO TRANSMITTER TO CALCULATE OIRECTION FRO"

PRIN1Z7
PRIN128
PRIN1Z9
PRIN130
PRIN131
PRIN13Z
PRIN133
PRIN134
PRIN13S

C.· •• • •• •• TRANSMITTER
PRINT 1500, V,NWHt,H,RANGE,ELL,POLAR,T,(RPRINT (NN' ,NN=l,NPU
1500 FORHAT (lX,E&.O,lX,A8,Fl0.4,F11.4,Z6X,F6.3,F9.3,F6.3,4F1Z.4)

PRIN13&
PRIN137
PRIN138

C········· STRAIGHT
LINE
(RCEZ'EPS"Z)
S~=SQRT

C.· .•.• ··•

.0 TO 40

PRIN139
PRIN140
PRIN1.1
IF (RCE.GE.1.E-6) GO TO 30
PRIN1.Z
C•• •• ••• •• NEARLY DIRECTLY ABOVE OR BELOW TRANSMITTER. CAN NOT CALCULATEPRIN143

C·········
ELEVATION ANGLE OF RAY POINT FROM TRANSMITTER
ZO EL=ATANZ(EPS.RCE)·OEGS

C............ AZIH~T~ DIRECTION FROM TRANSMITTER ACCURATELY
PRINT 2500, ~INWH",H,RANGE,EL,ELL,POLAR,TI(RPRINT(NN),NN%:l,NP1)
2500 FORHAT (lXIEo.0,lX,A6,Fl0.~,Fl1.4,17X,F9.3,F8.3,~q.3,F8.3,

1 .F1Z.,)
GO TO .0

PRIN144
PRIN145
PRIN146

PRIN147
PRIN148

80

C···~·····

AZIMUTH ANGLE OF RAY POINT FROM TRANSMITTER

30 ANGA=ATAN2(ETA,ZETAI
AZOEV=180. -AHOO (54 0.- (AZ1-ANGAl 'OEGS, 360.1
IF (R(51.NE.0 .. OR.R(61.NE.0.l GO TO 34

PRIN1~q

PRIN150
PRI N151
PRIN152

C········· HA~E NORMAL IS VERTICAL. SO AZIMUTH OIRECTION CANNOT BE
PRIN153
C········· CALCULATED
PRIN15~
PRINT 3000. ~.NWH"H,RAN;~.AZOEV,EL,ELl,~OLAR,T,(RPRINT(NN).NN=l, PRIN155
1 NPll

PRIN156

3000 FORHAT

(lX,E&.0,lX,A8,Fl0.~.Fl1.~.Fq.Jt8X,Fq.J,FS.3,Fq.3.F8.3,

~RIN151

1 4F12.41
GO TO 40
34 ANA=AN,A-ALPH
SANA=SIN (ANAl
SPHI=SANA'STHRISTH
CPHI=-SIN (PIOZ-ANAl'SIN (PIOZ-(PHI-PHIRll +SANA'SIN (PHI-PHIRI

PRIN158
PRIN159
PRIN160
PRIN161
PRIN162
PRIN163

1

.CTHR

PRIN16~

(540. - ( ATA ,~ 2 ( S PH I ,CP HI I - ATANZ (R ( 61 ,R (51 I I • 0 EGS , 360 • I PR IN 165

AZ A= 18 0 • - AHO 0

PRINT 3500,

V.NWHY.H,RAN~E,AZOEV.AZA,EL,ELLtPOLARtTt(RPRINT(NN),NN PRIN16&

1 =l,NPll

3500 FORHAT

PRIN167

(1(,E&.0,lX,A8.Fl0.4,Fl1.~,Z(Fq.3.F8.3},F9.3,F8.3,

1 4F1Z.41

PRIN169

C·········

PRIN170

40 LINE5=LINES+l
IF (NP.LE.31 GO TO 45
ADDITIONAL LINE TO PRINT REHAINING OEPENOENT INTEGRATION

C·········
C········· VARIABLES
c

c·········
PUNCH A RAVSET
IF (AlOEV.LT.-90.1
IF (AlA.LT.-90.1
TOEV=T-SR
NR=6
IF (W(571.EQ.0.l

AlOEV=AlOE~+360.

AlA=AZA+360.
GO TO 47

C········· PHASE PATH
NR=NR+l
POEV=R(NRl-S~

(W(581.EQ.0.l

c••• •••• •• ABSO~PTION

GO TO 48

NR=NR+1
ABSORB=R(NRI

C·········
48 IF

OO~PlER

SHIFT

(W(591.NE.O,1

~UNCH

~5QO,

PRIN171
PRIN172
PRIN173

PRIN174

F'RINT 4000, (RPRINT(NNl,NN=4,NPl
4000 FORHAT (99X,3F1Z,41
LINES=LINES+l
45 IF (CARO.EQ.O.l RETURN

.7 IF

PRIN1&8

OOPP=R(NR+ll

H~UNCH,RANGE,AZOEV.AZA,ELL,SR,TOEV,POEV.ABSORB,OOPP.

1 POLAR,IHOP,NWHY
4500 FORHAT (4P2F9.0,3P3F6.0,3PF8.0,3P4F6.0,2P2F5.0,Il.Al1
RETURN
ENO

81

PRIN175
PRIN176
PRIN177
PRIM178
PRIN179
PRI N180
PRI N181
PRIN182
PRIN183
PRIN184
PRIN185
PRIN186
PUN187
PRI N188
PRI N189
PRIN190
PRIN191
PRI N192
PRIN193
PRIN194
F'RIN195
PRIN196
PRI N197
PRIN198
PIUN199-
