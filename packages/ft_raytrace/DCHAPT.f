      SUBROUTINE DCHAPT
      COMMON /CONST/ PI,PIT2,PID2,DUM(5)
      COMMON /XX/ MODX(2),X,PXPR,PXPTH,PXPPH,PXPT,HMAX
      COMMON R(6) /WW/ ID(10),WQ,W(400)
      EQUIVALENCE (EARTHR,W(2)),(F,W(6)),(FC1,W(101)),(HM1,W(102)),
     1 (SH1,W(103)),(FC2,W(104)),(HM2,W(105)),(SH2,W(106)),(C,W(107)),
     2 (E,W(108)),(PERT,W(150))
      CHARACTER*6 MODX
      DATA MODX(1) /'DCHAPT'/
      ENTRY ELECTX
      EARTHE =EARTHR*E
      THETA2=R(2)-PID2
      HMAX=HM1+EARTHE*THETA2
      X=0.0
      PXPR=0.0
      PXPTH=0.0
      PXPPH=0.0
      H=R(1)-EARTHR
      IF (H.LE.0.0) GO TO 50
      Z1=(H-HMAX)/SH1
      EXPZ1=1.0-EXP(-Z1)
      TEMP=1.0+C*THETA2
      X=(FC1/F)**2*TEMP*EXP(.5*(EXPZ1-Z1))
      PXPR=-0.5*X*EXPZ1/SH1
      PXPTH=X*C/TEMP-PXPR*EARTHE
      IF (FC2.EQ.0.0) GO TO 50
      Z2=(H-HM2-EARTHE*THETA2)/SH2
      EXPZ2=1.0-EXP(-Z2)
      X2=(FC2/F)**2*TEMP*EXP(.5*(EXPZ2-Z2))
      X=X+X2
      PXPR2=-0.5*X2*EXPZ2/SH2
      PXPR=PXPR+PXPR2
      PXPTH=PXPTH+X2*C/TEMP-PXPR2*EARTHE
50    IF (PERT.NE.0.0) CALL ELECT1
      RETURN
      END