      SUBROUTINE DTORUS
      COMMON /CONST/ PI,PIT2,PID2,DUM(5)
      COMMON /XX/ MODX(2),X,PXPR,PXPTH,PXPPH,PXPT
      COMMON R(6) /WW/ ID(10),WQ,W(400)
      EQUIVALENCE (EARTHR,W(2)),(C1,W(151)),(A1,W(152)),(B1,W(153)),
     1 (BETA,W(154)),(H1,W(155)),(C2,W(156)),(A2,W(157)),(B2,W(158)),
     2 (H2,W(159))
      REAL LAMBDA1,LAMBDA2
      CHARACTER*6 MODX
      DATA MODX(2) /'DTORUS'/,PDPP /0.0/
      ENTRY ELECT1
      IF (X.NE.0.0) GOTO 20
      IF (PXPR.NE.0.0) GOTO 20
      IF (PXPTH.NE.0.0) GOTO 20
      IF (PXPPH.NE.0.0) GOTO 20
      RETURN
 20   CONTINUE
      IF (C1.EQ.0.0) RETURN
      R1=EARTHR+H1
      R2=EARTHR+H2
      Z1=R(1)-R1
      Z2=R(1)-R2
      LAMBDA1=R1*(R(2)-PID2)
      DTHETA=0.0
      IF (BETA .NE. 0.0) DTHETA=(H1-H2)/R2/TAN(BETA)
      LAMBDA2=R2*(R(2)-PID2+DTHETA)
      SINBET=SIN(BETA)
      COSBET=COS(BETA)
      P1=LAMBDA1*COSBET+Z1*SINBET
      P2=LAMBDA2*COSBET+Z2*SINBET
      Y1=Z1*COSBET-LAMBDA1*SINBET
      Y2=Z2*COSBET-LAMBDA2*SINBET
      DELTA1=C1*EXP(-(P1/A1)**2-(Y1/B1)**2)
      DELTA2=C2*EXP(-(P2/A2)**2-(Y2/B2)**2)
      DEL1=1.0+DELTA1+DELTA2
      PDPR1=-2.0*DELTA1*(P1*SINBET/A1**2+Y1*COSBET/B1**2)
      PDPR2=-2.0*DELTA2*(P2*SINBET/A2**2+Y2*COSBET/B2**2)
      PDPT1=-2.0*DELTA1*(P1*R1*COSBET/A1**2-Y1*R1*SINBET/B1**2)
      PDPT2=-2.0*DELTA2*(P2*R2*COSBET/A2**2-Y2*R2*SINBET/B2**2)
      PXPR=PXPR*DEL1+X*(PDPR1+PDPR2)
      PXPTH=PXPTH*DEL1+X*(PDPT1+PDPT2)
      PXPPH=PXPPH*DEL1*PDPP
      X=X*DEL1
      RETURN
      END